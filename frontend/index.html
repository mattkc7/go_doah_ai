<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go Monolith Vanilla JS Tester</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-50 flex items-center justify-center min-h-screen p-4">
    <div class="w-full max-w-lg">
        <div class="bg-white p-8 rounded-xl shadow-2xl space-y-6 w-full border-t-4 border-indigo-600">
            <h1 class="text-3xl font-extrabold text-gray-900">Go Backend API Tester (Vanilla JS)</h1>
            <p class="text-sm text-gray-500">
                This simple HTML/JS client is served by your Go Monolith and communicates using relative API paths.
            </p>

            <!-- Loading Indicator -->
            <div id="loadingIndicator" class="hidden bg-yellow-100 text-yellow-800 p-3 rounded-lg font-medium">
                Processing request...
            </div>

            <!-- 1. GET /status Check -->
            <button id="statusButton"
                class="w-full py-3 bg-indigo-600 text-white rounded-lg font-semibold hover:bg-indigo-700 transition duration-150 shadow-md">
                Check API /status (GET 200)
            </button>
            
            <div id="statusResult" class="hidden text-sm font-medium p-3 rounded-lg"></div>

            <div class="border-t pt-6 space-y-4">
                <h2 class="text-xl font-bold text-gray-800">POST /process Data</h2>

                <!-- 2. POST /process Inputs -->
                <input id="dataInput" type="text" placeholder="Enter data payload (string)"
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500 transition">
                <input id="idInput" type="number" placeholder="Enter ID (integer)" value="1"
                    class="w-full p-3 border border-gray-300 rounded-lg focus:ring-sky-500 focus:border-sky-500 transition">

                <!-- 3. POST /process Button -->
                <button id="processButton"
                    class="w-full py-3 bg-sky-600 text-white rounded-lg font-semibold hover:bg-sky-700 transition duration-150 shadow-md disabled:opacity-50"
                    disabled>
                    Send POST /process
                </button>
            </div>
        </div>
    </div>

    <!-- Response Modal (Pop-up) -->
    <div id="responseModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-75 flex items-center justify-center p-4 transition-opacity duration-300">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-md space-y-4">
            <h3 class="text-xl font-bold text-gray-800" id="modalTitle">API Response</h3>
            <pre class="bg-gray-100 p-3 rounded-lg text-xs text-gray-600 overflow-x-auto" id="modalContent"></pre>
            <button id="closeModal" class="w-full py-2 bg-red-500 text-white rounded-lg font-semibold hover:bg-red-600 transition">
                Close
            </button>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Element References ---
            const statusButton = document.getElementById('statusButton');
            const statusResult = document.getElementById('statusResult');
            const processButton = document.getElementById('processButton');
            const dataInput = document.getElementById('dataInput');
            const idInput = document.getElementById('idInput');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const responseModal = document.getElementById('responseModal');
            const modalTitle = document.getElementById('modalTitle');
            const modalContent = document.getElementById('modalContent');
            const closeModal = document.getElementById('closeModal');

            // --- Helper Functions ---

            const showLoading = (show) => {
                loadingIndicator.classList.toggle('hidden', !show);
                statusButton.disabled = show;
                processButton.disabled = show;
            };

            const showModal = (title, content) => {
                modalTitle.textContent = title;
                modalContent.textContent = content;
                responseModal.classList.remove('hidden');
            };

            const hideModal = () => {
                responseModal.classList.add('hidden');
            };

            const updateProcessButtonState = () => {
                const data = dataInput.value.trim();
                const id = idInput.value.trim();
                // Disable if data or ID is empty
                processButton.disabled = !data || !id;
            };

            // --- API Handlers ---

            // 1. GET /status API Call
            statusButton.addEventListener('click', async () => {
                showLoading(true);
                statusResult.classList.add('hidden'); // Hide previous result

                try {
                    const res = await fetch('/status');
                    
                    // Throw if the status is not successful (e.g., 500)
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }

                    const json = await res.json();
                    
                    statusResult.textContent = `Status: ${json.status} | Message: ${json.message}`;
                    statusResult.classList.remove('bg-red-100', 'text-red-700');
                    statusResult.classList.add('bg-green-100', 'text-green-700');
                    statusResult.classList.remove('hidden');

                } catch (error) {
                    statusResult.textContent = `Error: Failed to connect or received non-200 response.`;
                    statusResult.classList.remove('bg-green-100', 'text-green-700');
                    statusResult.classList.add('bg-red-100', 'text-red-700');
                    statusResult.classList.remove('hidden');
                } finally {
                    showLoading(false);
                }
            });

            // 2. POST /process API Call
            processButton.addEventListener('click', async () => {
                showLoading(true);
                statusResult.classList.add('hidden'); // Clear status check result

                const dataPayload = {
                    data: dataInput.value.trim(),
                    // Parse the ID as an integer for the Go backend
                    id: parseInt(idInput.value.trim()),
                };

                try {
                    const res = await fetch('/process', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(dataPayload),
                    });
                    
                    if (!res.ok) {
                        throw new Error(`HTTP error! status: ${res.status}`);
                    }

                    const json = await res.json();
                    
                    // Show response in modal
                    showModal(`POST /process Success (ID: ${json.received_id})`, JSON.stringify(json, null, 2));

                } catch (error) {
                    showModal("API Error", `Failed to communicate with the /process endpoint. Details: ${error.message}`);
                } finally {
                    showLoading(false);
                }
            });

            // --- Event Listeners ---
            dataInput.addEventListener('input', updateProcessButtonState);
            idInput.addEventListener('input', updateProcessButtonState);
            closeModal.addEventListener('click', hideModal);

            // Initial state update to enable/disable button based on input values
            updateProcessButtonState();
        });
    </script>
</body>
</html>